# Run from Raw/micro/

# 0. rename ncs files to CSC?.ncs
Code/Util/get_channel_names.py
Code/Util/rename_channel_names_to_CSCs.py

# 1. generate overview plots for raw signal
css-plot-rawsignal
# check new subfolder overview


# 2. extract spikes (not yet sorted) from all channels
css-extract --files *.ncs > css_extract.log
# new subfolder CSC were genereted with data_CSC*.h5 files

# 3. find artifacts
css-find-concurrent

# 4. remove artifacts
css-mask-artifacts

# 5. Sorting 
python simple_clustering_CSCs.py 


# 6. generate sorting plots
css-plot-sorted --label sort_pos_simple
css-plot-sorted --label sort_neg_simple --neg
#plot_sorted_CSC.py








###################################################################################
# The following is buggy - uses multiprocessing instead of single, like the above.
###################################################################################
# 5. prepare for sorting
prepare_sorting.py
# check multiple repetition (for some reason it recurs)
ls CSC*/
cat sort_pos_yl2.txt
cat sort_neg_yl2.txt
# (TODO: check if needs to remove these duplications - is it a bug in Combinato?)


# 6. Sorting
css-cluster --jobs sort_pos_yl2.txt 2>&1 | tee sort_pos.log 
css-cluster --jobs sort_neg_yl2.txt 2>&1 | tee sort_neg.log

# 7. combine
css-combine --jobs sort_pos_yl2.txt 2>&1 | tee combine_pos.log
css-combine --jobs sort_neg_yl2.txt 2>&1 | tee combine_neg.log
# doesn't work well yet

# 8. generate sorting plots
css-plot-sorted --label sort_pos_yl2
plot_sorted_CSC.py
# still get errors


# 9. Use the GUIs to optimize results
css-overview-gui
# enter the sorting label sort_pos_abc and initialize the folder (from the menu or by pressing Ctrl+I).

# 10. Manual fix:
css-gui


